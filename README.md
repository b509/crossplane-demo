# k3d Cluster

## Create
```
sudo k3d cluster create crossplane-demo
sudo k3d kubeconfig merge crossplane-demo --kubeconfig-switch-context -o /home/<username>/.kube/config
sudo chown <username>:<username> ~/.kube/config 
```

## Start and Stop
```
sudo k3d cluster stop crossplane-demo
sudo k3d cluster start crossplane-demo
```

# Crossplane
https://docs.crossplane.io/latest/software/install/

## Install via Helm
```
helm repo add crossplane-stable https://charts.crossplane.io/stable
helm repo update
```

```
helm install crossplane \
--namespace crossplane-system \
--create-namespace crossplane-stable/crossplane 
```

# Crossplane UI

## Install via Helm
```
helm repo add komodorio https://helm-charts.komodor.io 
helm repo update  
helm install komoplane komodorio/komoplane --set "ingress.enabled=true,ingress.hosts[0].host=komoplane.k8s.local,ingress.hosts[0].paths[0].path=/,ingress.hosts[0].paths[0].pathType=ImplementationSpecific"
```

Add entry to /etc/hosts
```
<LoadBalancerIP> komoplane.k8s.local
```

Crossplane UI URL: http://komoplane.k8s.local/

# Testing with Grafana
## Install Grafana via Helm
https://github.com/grafana/helm-charts/blob/main/charts/grafana/README.md


```
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update
helm install my-release grafana/grafana --set "adminUser=admin,adminPassword=password,ingress.enabled=true,ingress.hosts[0]=grafana.k8s.local"
```

Add entry to /etc/hosts
```
<LoadBalancerIP> grafana.k8s.local
```

Grafana URL: http://grafana.k8s.local/

## Install Crossplane Grafana Provider
[Grafana Provider](https://marketplace.upbound.io/providers/grafana/provider-grafana/v0.8.0) was generated by [upjet](https://github.com/upbound/upjet).

Therefore Provider configuration can be inferred by:
https://registry.terraform.io/providers/grafana/grafana/latest/docs#schema


```
kubectl apply -f ./k8s/crossplane
```

